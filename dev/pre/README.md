# Appraise job preparation

Note that lots of this code has been obtained by modifying existing code containing other functionalities.  Remnants of the code used there are still found here. Some time would be needed to streamline this code. 

## prepare_one_2.py

Takes two files: a reference text file, a hint text file, and produces an XML results file.
In this project, both the reference and the hint text are a single sentence.

This is meant to be called by wrapper.py below, never directly.

If --no_hint is given, the hint text is ignored.

One can set the percentage of gaps (e.g.  --percentage 20 for 20%), the source language (--sl), the target language (--tl) which will be used to label the XML file. A document id (--docid) is also provided.

If a list of stopwords is available for the language in question from package stop_words, then holes are never punched where stopwords are. 

The switch --adjacent_gaps_not_ok avoids punching gaps which are adjacents or just separated by stopwords.

The switch --system labels the system used.



```
usage: prepare_one_2.py [-h] [--percentage PERCENTAGE] [-v]
                        [--include_stopwords] [--include_punctuation]
                        [--no_hint] [--setid SETID] [--docid DOCID] [--sl SL]
                        [--tl TL] [--system SYSTEM] 
                        [--adjacent_gaps_not_ok]
                        reftextfile hinttextfile resultfile

``` 

## wrapper.py

This program receives an informant number, the directory where all problem files are kept  (in directories
such as human, google, yandex, etc., and the names of files to get from each of these directories) and generates
a in /tmp/i where i is the informant number set of one-problem XML files that will later be merged by merger.py.

The code may be improved massively, as it has a number of hard-wired parameters such as the names of the directories (named after the systems).



```
usage: wrapper.py [-h] [-v] [--dry_run] [--sl SL] [--tl TL]
                  [--target_dir TARGET_DIRECTORY]
                  informant documents_root problemfiles [problemfiles ...]

positional arguments:
  informant             Informant number
  documents_root        root of document files
  problemfiles          names of problems to process

optional arguments:
  -h, --help            show this help message and exit
  -v, --verbose         Verbose Mode
  --dry_run             Dry run
  --sl SL               Source language
  --tl TL               Source language
  --target_dir TARGET_DIRECTORY
                        Target directory
```

Example:

```
python wrapper.py  -v --sl en --tl kk 0 ../kazengex/ text1 text2 text3 text4 text5 text6 text7
```
Here the informant is number 0, but it can be called in a loop:
```
for i in {00..10}; do python wrapper.py  -v --sl en --tl kk $i ../kazengex/ text1 text2 text3 text4 text5 text6 text7; done
```
This creates a series of directories 00, 01 etc. where the XML files for each job are stored.

## merger.py 

Concatenates a series of XML tasks generated by prepare_one_2.py into a single XML file (specified by --output) by wrapping it in <set...>/</set>, ready to be ingested by Appraise. The job may be given a set identifier (--setid).

XML files concatenated should each one contain a single segment (as generated by prepare_one_2.py).

usage: 

```
merger.py [-h] [--setid SETID] [--outfile OUTFILE]
                 mergefile [mergefile ...]

positional arguments:
  mergefile          files to merge

optional arguments:
  -h, --help         show this help message and exit
  --setid SETID      New set identifier
  --outfile OUTFILE  Output file
```

This would usually be called after wrapper.py in a loop, to generate the job files to be uploaded to Appraise:

```
for i in {00..10}; do python merger.py --setid $i --outfile /tmp/enkkjob$i.xml /tmp/$i/*.xml ; done
```
In this case, the job files are enkkjobNN.xml 

